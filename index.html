<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrador de Préstamos</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configuración de Tailwind y Fuente Inter -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        };
    </script>

    <!-- Estilos CSS personalizados -->
    <style>
        /* Estilo para el cuerpo con un fondo suave */
        body {
            background-color: #f0f4f8;
            font-family: 'Inter', sans-serif;
        }

        /* Efecto de gradiente en botones y cabecera */
        .gradient-btn {
            background-image: linear-gradient(to right, #4f46e5, #7c3aed);
        }
        .gradient-header {
            background-image: linear-gradient(to right, #4338ca, #6d28d9);
        }
        
        /* Animación suave para los elementos de la lista */
        .loan-item {
            transition: all 0.2s ease-in-out;
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="antialiased">

    <div class="min-h-screen">
        <!-- Cabecera -->
        <header class="gradient-header text-white p-6 shadow-md sticky top-0 z-10">
            <div class="container mx-auto max-w-2xl flex items-center gap-4">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8">
                    <path d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6ZM12 1.5a.75.75 0 0 0-.75.75v3a.75.75 0 0 0 1.5 0v-3A.75.75 0 0 0 12 1.5Z" />
                    <path d="M3.062 6.75a.75.75 0 0 0-1.124.936 9.001 9.001 0 0 0 17.123 0 .75.75 0 0 0-1.125-.936A7.501 7.501 0 0 1 3.062 6.75Z" />
                </svg>
                <!-- CAMBIO: Título actualizado -->
                <h1 class="text-2xl font-bold">Préstamos</h1>
            </div>
        </header>

        <!-- Contenido Principal -->
        <main class="container mx-auto max-w-2xl p-4">

            <!-- Tarjeta de Resumen y Nuevo Préstamo -->
            <section class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <div class="text-center">
                    <p class="text-lg text-gray-600">Total prestado</p>
                    <h2 id="total-borrowed" class="text-5xl font-extrabold text-indigo-600 my-2">$0.00</h2>
                    <button id="new-loan-btn" class="gradient-btn text-white font-semibold py-3 px-8 rounded-full shadow-lg transform hover:scale-105 transition-transform duration-200 flex items-center justify-center mx-auto mt-4">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 mr-2">
                            <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z" clip-rule="evenodd" />
                        </svg>
                        Nuevo Préstamo
                    </button>
                </div>
            </section>

            <!-- Lista de Préstamos -->
            <section class="bg-white rounded-lg shadow-lg overflow-hidden">
                <!-- Cabecera de la lista -->
                <div class="grid grid-cols-4 md:grid-cols-4 gap-4 p-4 border-b border-gray-200 bg-gray-50">
                    <h3 class="font-semibold text-gray-700">Cantidad</h3>
                    <h3 class="font-semibold text-gray-700">Concepto</h3>
                    <h3 class="font-semibold text-gray-700 hidden md:block">Fecha</h3>
                    <h3 class="font-semibold text-gray-700 text-right">Acciones</h3>
                </div>
                
                <!-- Contenedor de la lista de préstamos -->
                <div id="loan-list">
                    <!-- Los préstamos se insertarán aquí -->
                </div>

                <!-- Pie de la lista (Total) -->
                <div class="flex justify-end p-4 bg-gray-50 border-t border-gray-200">
                    <span class="text-lg font-bold text-gray-800">Total:</span>
                    <span id="list-total" class="text-lg font-bold text-gray-800 ml-4 w-32 text-right">$0.00</span>
                </div>
            </section>

            <!-- Mensaje de guardado -->
            <div class="text-center text-gray-500 mt-6 flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                    <path d="M10 2a.75.75 0 0 1 .75.75v.518a3.75 3.75 0 0 1 0 7.464v.518a.75.75 0 0 1-1.5 0v-.518a3.75 3.75 0 0 1 0-7.464V2.75A.75.75 0 0 1 10 2Z" />
                    <path fill-rule="evenodd" d="M12.59 4.604a.75.75 0 0 1 .94-.332 5.25 5.25 0 0 1 1.92 6.674.75.75 0 0 1-1.251-.351 3.75 3.75 0 0 0-1.36-4.896.75.75 0 0 1 .751-.94v-.001Z" clip-rule="evenodd" />
                    <path fill-rule="evenodd" d="M7.41 4.604a.75.75 0 0 0-.94-.332 5.25 5.25 0 0 0-1.92 6.674.75.75 0 0 0 1.251-.351 3.75 3.75 0 0 1 1.36-4.896.75.75 0 0 0-.751-.94v-.001Z" clip-rule="evenodd" />
                    <path fill-rule="evenodd" d="M10 18a.75.75 0 0 1-.75-.75V16.75a5.25 5.25 0 0 1 0-10.5V5.75a.75.75 0 0 1 1.5 0v.5a3.75 3.75 0 0 0 0 7.5v.5a.75.75 0 0 1-.75.75Z" clip-rule="evenodd" />
                    <path fill-rule="evenodd" d="M10 18a8.25 8.25 0 1 0 0-16.5 8.25 8.25 0 0 0 0 16.5ZM1.5 10a8.5 8.5 0 1 1 17 0 8.5 8.5 0 0 1-17 0Z" clip-rule="evenodd" />
                </svg>
                Datos guardados en tu navegador
            </div>
        </main>
    </div>

    <!-- Modal para Nuevo/Editar Préstamo -->
    <div id="loan-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <h3 id="modal-title" class="text-xl font-semibold p-6 border-b border-gray-200">Nuevo Préstamo</h3>
            <form id="loan-form" class="p-6">
                <!-- Campo oculto para el ID de edición -->
                <input type="hidden" id="loan-id">
                
                <!-- Campo Cantidad -->
                <div class="mb-4">
                    <label for="loan-amount" class="block text-sm font-medium text-gray-700 mb-1">Cantidad</label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                        <input type="number" id="loan-amount" step="0.01" min="0.01" class="w-full pl-7 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="100.00" required>
                    </div>
                </div>
                
                <!-- Campo Concepto -->
                <div class="mb-6">
                    <label for="loan-concept" class="block text-sm font-medium text-gray-700 mb-1">Concepto</label>
                    <input type="text" id="loan-concept" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="Ej: Préstamo 1, Didi" required>
                </div>
                
                <!-- Botones del formulario -->
                <div class="flex justify-end gap-4">
                    <button type="button" id="cancel-btn" class="bg-gray-200 text-gray-800 font-semibold py-2 px-6 rounded-lg hover:bg-gray-300 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="gradient-btn text-white font-semibold py-2 px-6 rounded-lg shadow hover:opacity-90 transition-opacity">
                        Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Contenedor para mensajes de error/confirmación -->
    <div id="message-box" class="fixed top-5 right-5 z-[100] hidden p-4 rounded-lg shadow-lg text-white max-w-sm">
        <span id="message-text"></span>
    </div>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Elementos del DOM ---
            const totalBorrowedEl = document.getElementById('total-borrowed');
            const listTotalEl = document.getElementById('list-total');
            const loanListEl = document.getElementById('loan-list');
            const newLoanBtn = document.getElementById('new-loan-btn');
            
            // Modal
            const modal = document.getElementById('loan-modal');
            const modalTitle = document.getElementById('modal-title');
            const loanForm = document.getElementById('loan-form');
            const cancelBtn = document.getElementById('cancel-btn');
            const loanIdInput = document.getElementById('loan-id');
            const loanAmountInput = document.getElementById('loan-amount');
            const loanConceptInput = document.getElementById('loan-concept');
            
            // Mensajes
            const messageBox = document.getElementById('message-box');
            const messageText = document.getElementById('message-text');

            // --- Estado de la Aplicación ---
            let loans = [];
            let editingId = null;

            // --- Funciones ---

            /**
             * Muestra un mensaje temporal (como un "toast").
             * @param {string} message - El texto del mensaje.
             * @param {('success' | 'error')} type - El tipo de mensaje.
             */
            function showMessage(message, type = 'success') {
                messageText.textContent = message;
                messageBox.className = messageBox.className.replace(/bg-.*-500|hidden/g, ''); // Limpia clases
                
                if (type === 'success') {
                    messageBox.classList.add('bg-green-500');
                } else {
                    messageBox.classList.add('bg-red-500');
                }
                
                messageBox.classList.remove('hidden');
                
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 3000); // Oculta después de 3 segundos
            }

            /**
             * Formatea un número como moneda (Ej: $1,234.50).
             * @param {number} value - El valor numérico.
             * @returns {string} - El valor formateado.
             */
            const formatCurrency = (value) => {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD', // Puedes cambiarlo a MXN si prefieres
                    minimumFractionDigits: 2
                }).format(value);
            };

            /**
             * Formatea una marca de tiempo a una cadena legible (DD/MM/YYYY, HH:MM).
             * @param {number} timestamp - La marca de tiempo (Ej: Date.now()).
             * @returns {string} - La fecha formateada.
             */
            const formatDate = (timestamp) => {
                const date = new Date(timestamp);
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                return `${day}/${month}/${year}, ${hours}:${minutes}`;
            };

            /**
             * Guarda la lista de préstamos en localStorage.
             * (Esta función ya estaba implementada)
             */
            const saveLoans = () => {
                try {
                    localStorage.setItem('loans', JSON.stringify(loans));
                } catch (error)
                {
                    console.error("No se pudo guardar en localStorage:", error);
                    showMessage("Error al guardar los datos.", 'error');
                }
            };

            /**
             * Carga la lista de préstamos desde localStorage.
             * (Esta función ya estaba implementada)
             */
            const loadLoans = () => {
                try {
                    const storedLoans = localStorage.getItem('loans');
                    loans = storedLoans ? JSON.parse(storedLoans) : [];
                } catch (error) {
                    console.error("Error al cargar datos de localStorage:", error);
                    loans = [];
                    showMessage("No se pudieron cargar los datos guardados.", 'error');
                }
            };

            /**
             * Renderiza la lista de préstamos en el DOM y actualiza los totales.
             */
            const renderLoans = () => {
                // Limpia la lista actual
                loanListEl.innerHTML = '';
                
                let total = 0;
                
                if (loans.length === 0) {
                    loanListEl.innerHTML = `
                        <p class="text-center text-gray-500 p-6">
                            No hay préstamos registrados.
                        </p>
                    `;
                } else {
                    // Ordena por fecha más reciente primero
                    const sortedLoans = [...loans].sort((a, b) => b.id - a.id);
                    
                    sortedLoans.forEach(loan => {
                        total += loan.amount;
                        
                        const loanEl = document.createElement('div');
                        loanEl.className = 'loan-item grid grid-cols-4 md:grid-cols-4 gap-4 p-4 border-b border-gray-200 items-center';
                        loanEl.innerHTML = `
                            <div class="font-medium text-gray-900">${formatCurrency(loan.amount)}</div>
                            <div class="text-gray-700 truncate">${loan.concept}</div>
                            <div class="text-gray-500 text-sm hidden md:block">${loan.date}</div>
                            <div class="flex justify-end gap-2">
                                <!-- CAMBIO: Botón Editar (Icono de Lápiz) -->
                                <button data-id="${loan.id}" class="edit-btn bg-blue-100 text-blue-600 p-2 rounded-lg hover:bg-blue-200 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                      <path d="M13.586 3.586a2 2 0 1 1 2.828 2.828l-9.9 9.9-3.536.707a.75.75 0 0 1-.85-.85l.707-3.536 9.9-9.9Z" />
                                      <path d="M17.657 2.343a.75.75 0 0 1 0 1.06l-2.121 2.121-1.06-1.06 2.12-2.121a.75.75 0 0 1 1.061 0Z" />
                                    </svg>
                                </button>
                                <!-- CAMBIO: Botón Eliminar (Icono de Bote de Basura) -->
                                <button data-id="${loan.id}" class="delete-btn bg-red-100 text-red-600 p-2 rounded-lg hover:bg-red-200 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                      <path fill-rule="evenodd" d="M17 5a.75.75 0 0 1 .75.75V6.5a.75.75 0 0 1-1.5 0V6.25H3.75V6.5a.75.75 0 0 1-1.5 0V5.75a.75.75 0 0 1 .75-.75h13.5ZM5 7.75A.75.75 0 0 1 5.75 7h8.5a.75.75 0 0 1 .75.75v9.5a.75.75 0 0 1-.75.75h-8.5a.75.75 0 0 1-.75-.75v-9.5ZM6.5 9.25a.75.75 0 0 0-.75.75v6.5a.75.75 0 0 0 1.5 0v-6.5a.75.75 0 0 0-.75-.75ZM10 9.25a.75.75 0 0 0-.75.75v6.5a.75.75 0 0 0 1.5 0v-6.5a.75.75 0 0 0-.75-.75Zm3.5 0a.75.75 0 0 0-.75.75v6.5a.75.75 0 0 0 1.5 0v-6.5a.75.75 0 0 0-.75-.75Z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                        `;
                        loanListEl.appendChild(loanEl);
                    });
                }
                
                // Actualizar totales
                const formattedTotal = formatCurrency(total);
                totalBorrowedEl.textContent = formattedTotal;
                listTotalEl.textContent = formattedTotal;
            };

            /**
             * Abre el modal, opcionalmente rellenándolo para edición.
             * @param {number | null} [id=null] - El ID del préstamo a editar, o null para crear uno nuevo.
             */
            const openModal = (id = null) => {
                loanForm.reset();
                if (id) {
                    editingId = id;
                    const loan = loans.find(l => l.id === id);
                    if (loan) {
                        modalTitle.textContent = 'Editar Préstamo';
                        loanIdInput.value = id;
                        loanAmountInput.value = loan.amount;
                        loanConceptInput.value = loan.concept;
                    }
                } else {
                    editingId = null;
                    modalTitle.textContent = 'Nuevo Préstamo';
                    loanIdInput.value = '';
                }
                modal.classList.remove('hidden');
            };

            /**
             * Cierra el modal.
             */
            const closeModal = () => {
                modal.classList.add('hidden');
                loanForm.reset();
                editingId = null;
            };

            /**
             * Maneja el envío del formulario (Crear o Actualizar).
             * @param {Event} e - El evento de envío del formulario.
             */
            const handleFormSubmit = (e) => {
                e.preventDefault();
                
                const amount = parseFloat(loanAmountInput.value);
                const concept = loanConceptInput.value.trim();
                
                // Validación simple
                if (isNaN(amount) || amount <= 0) {
                    showMessage("Por favor, introduce una cantidad válida.", 'error');
                    loanAmountInput.focus();
                    return;
                }
                if (concept === '') {
                    showMessage("Por favor, introduce un concepto.", 'error');
                    loanConceptInput.focus();
                    return;
                }
                
                if (editingId) {
                    // --- Actualizando ---
                    const index = loans.findIndex(l => l.id === editingId);
                    if (index !== -1) {
                        loans[index].amount = amount;
                        loans[index].concept = concept;
                        // Opcional: actualizar la fecha al editar
                        // loans[index].date = formatDate(Date.now()); 
                    }
                    showMessage("Préstamo actualizado con éxito.", 'success');
                } else {
                    // --- Creando Nuevo ---
                    const newLoan = {
                        id: Date.now(), // ID único basado en la marca de tiempo
                        amount: amount,
                        concept: concept,
                        date: formatDate(Date.now())
                    };
                    loans.push(newLoan);
                    showMessage("Préstamo agregado con éxito.", 'success');
                }
                
                saveLoans();
                renderLoans();
                closeModal();
            };

            /**
             * Maneja los clics en la lista de préstamos (Editar o Eliminar).
             * @param {Event} e - El evento de clic.
             */
            const handleListClick = (e) => {
                const button = e.target.closest('button');
                if (!button) return;

                const id = Number(button.dataset.id);

                if (button.classList.contains('edit-btn')) {
                    // --- Botón Editar ---
                    openModal(id);
                } else if (button.classList.contains('delete-btn')) {
                    // --- Botón Eliminar ---
                    // (Aquí podrías agregar una confirmación)
                    loans = loans.filter(l => l.id !== id);
                    saveLoans();
                    renderLoans();
                    showMessage("Préstamo eliminado.", 'success');
                }
            };

            // --- Inicialización y Event Listeners ---
            
            // Cargar datos al iniciar
            loadLoans();
            renderLoans();

            // Abrir modal para nuevo préstamo
            newLoanBtn.addEventListener('click', () => openModal());
            
            // Cerrar modal
            cancelBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                // Cierra si se hace clic en el fondo oscuro
                if (e.target === modal) {
                    closeModal();
                }
            });
            
            // Guardar (Submit del formulario)
            loanForm.addEventListener('submit', handleFormSubmit);
            
            // Clics en la lista (delegación de eventos)
            loanListEl.addEventListener('click', handleListClick);
        });
    </script>
</body>
</html>


